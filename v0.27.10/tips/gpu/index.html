<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>GPU usage · VortexPasta</title><meta name="title" content="GPU usage · VortexPasta"/><meta property="og:title" content="GPU usage · VortexPasta"/><meta property="twitter:title" content="GPU usage · VortexPasta"/><meta name="description" content="Documentation for VortexPasta."/><meta property="og:description" content="Documentation for VortexPasta."/><meta property="twitter:description" content="Documentation for VortexPasta."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/fonts.css" rel="stylesheet" type="text/css"/><script src="../../assets/sa.js" data-collect-dnt="true" async></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VortexPasta</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">VortexPasta.jl</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/01-vortex_ring/">Vortex ring</a></li><li><a class="tocitem" href="../../tutorials/02-kelvin_waves/">Kelvin waves</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../methods/VFM/">The vortex filament model</a></li><li><a class="tocitem" href="../../methods/Ewald/">Ewald summation for Biot–Savart</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tips and tricks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../parallelisation/">Parallelisation and clusters</a></li><li class="is-active"><a class="tocitem" href>GPU usage</a><ul class="internal"><li><a class="tocitem" href="#Using-a-local-CUDA-toolkit"><span>Using a local CUDA toolkit</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Modules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../modules/PaddedArrays/">PaddedArrays</a></li><li><a class="tocitem" href="../../modules/PredefinedCurves/">PredefinedCurves</a></li><li><a class="tocitem" href="../../modules/CellLists/">CellLists</a></li><li><a class="tocitem" href="../../modules/Quadratures/">Quadratures</a></li><li><a class="tocitem" href="../../modules/Filaments/">Filaments</a></li><li><a class="tocitem" href="../../modules/FilamentIO/">FilamentIO</a></li><li><a class="tocitem" href="../../modules/FindNearbySegments/">FindNearbySegments</a></li><li><a class="tocitem" href="../../modules/Constants/">Constants</a></li><li><a class="tocitem" href="../../modules/BiotSavart/">BiotSavart</a></li><li><a class="tocitem" href="../../modules/SyntheticFields/">SyntheticFields</a></li><li><a class="tocitem" href="../../modules/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../modules/Containers/">Containers</a></li><li><a class="tocitem" href="../../modules/Reconnections/">Reconnections</a></li><li><a class="tocitem" href="../../modules/Timestepping/">Timestepping</a></li><li><a class="tocitem" href="../../modules/Diagnostics/">Diagnostics</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tips and tricks</a></li><li class="is-active"><a href>GPU usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>GPU usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jipolanco/VortexPasta.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jipolanco/VortexPasta.jl/blob/master/docs/src/tips/gpu.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="GPU-usage"><a class="docs-heading-anchor" href="#GPU-usage">GPU usage</a><a id="GPU-usage-1"></a><a class="docs-heading-anchor-permalink" href="#GPU-usage" title="Permalink"></a></h1><p>Currently, it is possible to accelerate the computation of <a href="../../methods/Ewald/#Long-range-velocity">long-range interactions</a> using GPUs. To do this, one should set <code>backend_long = NonuniformFFTsBackend(...)</code> when creating a <a href="../../modules/BiotSavart/#VortexPasta.BiotSavart.ParamsBiotSavart"><code>ParamsBiotSavart</code></a> and use the wanted GPU device as detailed in <a href="../../modules/BiotSavart/#VortexPasta.BiotSavart.NonuniformFFTsBackend"><code>NonuniformFFTsBackend</code></a>.</p><h2 id="Using-a-local-CUDA-toolkit"><a class="docs-heading-anchor" href="#Using-a-local-CUDA-toolkit">Using a local CUDA toolkit</a><a id="Using-a-local-CUDA-toolkit-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-local-CUDA-toolkit" title="Permalink"></a></h2><p>By default, CUDA.jl will download the CUDA toolkit when it is first used. One may want to avoid it and instead use a CUDA toolkit already installed in the system. This is particularly important on <strong>HPC clusters</strong>, where an internet connection may not be available on compute nodes (GPU-enabled) but only on login nodes (without GPUs).</p><p>To do this, one should first determine the version of the available CUDA toolkit. This may be obtained by running <code>nvcc --version</code> on the system where computations will be performed (e.g. from a compute node). Look for a line similar to <code>Cuda compilation tools, release 12.4, V12.4.131</code> (here the version is <code>12.4</code>). On HPC clusters, one may first need to load a CUDA module, e.g. <code>module load cuda</code> (but this will depend on the cluster).</p><p>Then, the configuration should be performed in the two steps detailed below. The first one, done in the global environment, should only be done once (until either the CUDA or the Julia version change, in which case it should be repeated). The second step is simpler and should be done each time CUDA.jl is to be used in a local project (e.g. along VortexPasta.jl).</p><h3 id="1.-Installing-CUDA.jl-on-the-global-environment"><a class="docs-heading-anchor" href="#1.-Installing-CUDA.jl-on-the-global-environment">1. Installing CUDA.jl on the global environment</a><a id="1.-Installing-CUDA.jl-on-the-global-environment-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Installing-CUDA.jl-on-the-global-environment" title="Permalink"></a></h3><p>Now, install CUDA.jl on the <em>global</em> Julia environment<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> from a machine with internet access (typically the login node, without GPU). For this, launch <code>julia</code> <em>without</em> the <code>--project</code> flag (to use the global environment), and then:</p><pre><code class="language-julia-repl hljs">julia&gt; using Pkg; Pkg.add(&quot;CUDA&quot;)  # install CUDA.jl

julia&gt; using CUDA

julia&gt; CUDA.set_runtime_version!(v&quot;12.4&quot;; local_toolkit = true)</code></pre><p>The <code>12.4</code> should be replaced with the CUDA version found using <code>nvcc --version</code>. See the <a href="https://cuda.juliagpu.org/dev/installation/overview/#Using-a-local-CUDA">CUDA.jl docs</a> for more details.</p><p>This should generate a <code>LocalPreferences.toml</code> file under <code>$JULIA_DEPOT_PATH/environments/v1.11/</code> (replace <code>v1.11</code> with the current Julia version), which should look as follows:</p><pre><code class="language-toml hljs">[CUDA_Runtime_jll]
local = &quot;true&quot;
version = &quot;12.4&quot;</code></pre><p>Afterwards, it may be helpful to launch <code>julia</code> again and run:</p><pre><code class="language-julia-repl hljs">julia&gt; using CUDA

julia&gt; CUDA.precompile_runtime()</code></pre><h3 id="2.-Using-CUDA.jl-in-a-local-environment"><a class="docs-heading-anchor" href="#2.-Using-CUDA.jl-in-a-local-environment">2. Using CUDA.jl in a local environment</a><a id="2.-Using-CUDA.jl-in-a-local-environment-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Using-CUDA.jl-in-a-local-environment" title="Permalink"></a></h3><p>After CUDA.jl has been configured in the global environment, one would want to reuse the same configuration in a local environment (which may contain other packages such as VortexPasta.jl to be used in a local project).</p><p>To do this, launch Julia from the environment associated to the local project by doing something like <code>julia --project=.</code> (see <a href="../../#julia-local-environments">Local environments</a> for more details).</p><p>Then, &quot;install&quot; CUDA.jl in this environment:</p><pre><code class="language-julia-repl hljs">julia&gt; using Pkg; Pkg.add(&quot;CUDA&quot;)</code></pre><p>That&#39;s it!</p><p>This local installation seems to be needed even if CUDA.jl is already in the global environment, probably because the versions of other packages in the local project are compatible with the installed CUDA.jl version (so they might be downgraded when adding CUDA).</p><p>Finally, one can check the CUDA.jl configuration on a GPU-enabled node:</p><pre><code class="language-julia-repl hljs">julia&gt; using CUDA

julia&gt; CUDA.versioninfo()
CUDA runtime 12.4, local installation
CUDA driver 12.6
NVIDIA driver 550.90.7

CUDA libraries:
- CUBLAS: 12.4.5
- CURAND: 10.3.5
- CUFFT: 11.2.1
- CUSOLVER: 11.6.1
- CUSPARSE: 12.3.1
- CUPTI: 2024.1.1 (API 22.0.0)
- NVML: 12.0.0+550.90.7

Julia packages:
- CUDA: 5.5.2
- CUDA_Driver_jll: 0.10.4+0
- CUDA_Runtime_jll: 0.15.5+0
- CUDA_Runtime_Discovery: 0.3.5

Toolchain:
- Julia: 1.11.2
- LLVM: 16.0.6

Preferences:
- CUDA_Runtime_jll.version: 12.4
- CUDA_Runtime_jll.local: true

1 device:
  0: NVIDIA H100 80GB HBM3 (sm_90, 79.092 GiB / 79.647 GiB available)</code></pre><p>One can verify that the <code>Preferences</code> section contains the same values as the <code>LocalPreferences.toml</code> file generated in the global environment.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>It&#39;s not strictly necessary to do this step in the global environment (it could be done each time CUDA.jl is installed on a local environment), but it&#39;s a convenient way of doing this once and for all.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../parallelisation/">« Parallelisation and clusters</a><a class="docs-footer-nextpage" href="../../modules/PaddedArrays/">PaddedArrays »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Monday 16 June 2025 14:14">Monday 16 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
