<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Parallelisation and clusters | VortexPasta</title>
    <meta name="description" content="Documentation for VortexPasta.jl">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/VortexPasta.jl/dev/assets/style.C5YA5t4Z.css" as="style">
    <link rel="preload stylesheet" href="/VortexPasta.jl/dev/vp-icons.css" as="style">
    
    <script type="module" src="/VortexPasta.jl/dev/assets/app.Bh5ocHpI.js"></script>
    <link rel="preload" href="/VortexPasta.jl/dev/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/VortexPasta.jl/dev/assets/chunks/theme.zkzCsA83.js">
    <link rel="modulepreload" href="/VortexPasta.jl/dev/assets/chunks/framework.BxmU8EDa.js">
    <link rel="modulepreload" href="/VortexPasta.jl/dev/assets/tips_parallelisation.md.D2PX0QPC.lean.js">
    <link rel="icon" href="/VortexPasta.jl/dev/favicon.png">
    <script src="/VortexPasta.jl/versions.js"></script>
    <script src="/VortexPasta.jl/dev/siteinfo.js"></script>
    <script src="/VortexPasta.jl/dev/sa.js" async data-collect-dnt="true"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-492508fc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-492508fc>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-0f4f798b><a class="title" href="/VortexPasta.jl/dev/" data-v-0f4f798b><!--[--><!--]--><!--[--><img class="VPImage logo" src="/VortexPasta.jl/dev/logo.png" width="24" height="24" alt data-v-35a7d0b8><!--]--><span data-v-0f4f798b>VortexPasta</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/VortexPasta.jl/dev/index" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>VortexPasta.jl</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Tutorials</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/tutorials/01-vortex_ring" data-v-acbfed09><!--[--><span data-v-acbfed09>Vortex ring</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/tutorials/02-kelvin_waves" data-v-acbfed09><!--[--><span data-v-acbfed09>Kelvin waves</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Explanations</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/methods/VFM" data-v-acbfed09><!--[--><span data-v-acbfed09>The vortex filament model</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/methods/Ewald" data-v-acbfed09><!--[--><span data-v-acbfed09>Ewald summation for Biot–Savart</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Tips and tricks</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link active" href="/VortexPasta.jl/dev/tips/parallelisation" data-v-acbfed09><!--[--><span data-v-acbfed09>Parallelisation and clusters</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/tips/gpu" data-v-acbfed09><!--[--><span data-v-acbfed09>GPU usage</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Modules</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/PaddedArrays" data-v-acbfed09><!--[--><span data-v-acbfed09>PaddedArrays</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/PredefinedCurves" data-v-acbfed09><!--[--><span data-v-acbfed09>PredefinedCurves</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/CellLists" data-v-acbfed09><!--[--><span data-v-acbfed09>CellLists</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Quadratures" data-v-acbfed09><!--[--><span data-v-acbfed09>Quadratures</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Filaments" data-v-acbfed09><!--[--><span data-v-acbfed09>Filaments</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/FilamentIO" data-v-acbfed09><!--[--><span data-v-acbfed09>FilamentIO</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/FindNearbySegments" data-v-acbfed09><!--[--><span data-v-acbfed09>FindNearbySegments</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Constants" data-v-acbfed09><!--[--><span data-v-acbfed09>Constants</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/BiotSavart" data-v-acbfed09><!--[--><span data-v-acbfed09>BiotSavart</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/SyntheticFields" data-v-acbfed09><!--[--><span data-v-acbfed09>SyntheticFields</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Forcing" data-v-acbfed09><!--[--><span data-v-acbfed09>Forcing</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/VectorsOfVectors" data-v-acbfed09><!--[--><span data-v-acbfed09>VectorsOfVectors</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Reconnections" data-v-acbfed09><!--[--><span data-v-acbfed09>Reconnections</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Timestepping" data-v-acbfed09><!--[--><span data-v-acbfed09>Timestepping</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/VortexPasta.jl/dev/modules/Diagnostics" data-v-acbfed09><!--[--><span data-v-acbfed09>Diagnostics</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/VortexPasta.jl/dev/references" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>References</span><!--]--></a><!--]--><!--[--><!----><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jipolanco/VortexPasta.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jipolanco/VortexPasta.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><div class="VPFlyout VPNolebaseEnhancedReadabilitiesMenu VPNolebaseEnhancedReadabilitiesMenuFlyout" aria-label="Enhanced Readability" role="menuitem" data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><span class="i-icon-park-outline:book-open option-icon" data-v-04f5c5e9></span><!----><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--]--></div></div></div><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-168ddf5d><button data-v-168ddf5d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/index" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>VortexPasta.jl</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Tutorials</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/tutorials/01-vortex_ring" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Vortex ring</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/tutorials/02-kelvin_waves" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Kelvin waves</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Explanations</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/methods/VFM" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>The vortex filament model</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/methods/Ewald" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Ewald summation for Biot–Savart</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible has-active" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Tips and tricks</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/tips/parallelisation" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Parallelisation and clusters</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/tips/gpu" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>GPU usage</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Modules</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/PaddedArrays" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>PaddedArrays</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/PredefinedCurves" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>PredefinedCurves</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/CellLists" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>CellLists</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Quadratures" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Quadratures</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Filaments" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Filaments</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/FilamentIO" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>FilamentIO</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/FindNearbySegments" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>FindNearbySegments</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Constants" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Constants</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/BiotSavart" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>BiotSavart</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/SyntheticFields" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>SyntheticFields</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Forcing" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Forcing</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/VectorsOfVectors" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>VectorsOfVectors</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Reconnections" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Reconnections</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Timestepping" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Timestepping</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/modules/Diagnostics" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Diagnostics</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/VortexPasta.jl/dev/references" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>References</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _VortexPasta_jl_dev_tips_parallelisation" data-v-83890dd9><div><h1 id="Parallelisation-and-clusters" tabindex="-1">Parallelisation and clusters <a class="header-anchor" href="#Parallelisation-and-clusters" aria-label="Permalink to &quot;Parallelisation and clusters {#Parallelisation-and-clusters}&quot;">​</a></h1><p>VortexPasta.jl can take advantage of thread-based CPU parallelisation (equivalent to OpenMP). In particular, it can be run on a single node of a computing cluster.</p><h2 id="Starting-Julia-with-multiple-threads" tabindex="-1">Starting Julia with multiple threads <a class="header-anchor" href="#Starting-Julia-with-multiple-threads" aria-label="Permalink to &quot;Starting Julia with multiple threads {#Starting-Julia-with-multiple-threads}&quot;">​</a></h2><p>There are <a href="https://docs.julialang.org/en/v1/manual/multi-threading/" target="_blank" rel="noreferrer">a few ways</a> of starting Julia with multiple threads:</p><ol><li><p>either via the <a href="https://docs.julialang.org/en/v1/manual/environment-variables/#JULIA_NUM_THREADS" target="_blank" rel="noreferrer"><code>JULIA_NUM_THREADS</code></a> environment variable,</p></li><li><p>or via the <code>-t / --threads</code> command-line option.</p></li></ol><p>If both are used, the second takes precedence.</p><p>The command-line flag can be used in two ways:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> julia</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # start Julia with 8 threads</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> julia</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # start Julia with the number of CPUs available to this Julia process</span></span></code></pre></div><p>The second option can be useful in particular when running <a href="/VortexPasta.jl/dev/tips/parallelisation#slurm-job">SLURM jobs</a>, as Julia will use the number of CPUs associated to the SLURM allocation.</p><h2 id="Pinning-threads" tabindex="-1">Pinning threads <a class="header-anchor" href="#Pinning-threads" aria-label="Permalink to &quot;Pinning threads {#Pinning-threads}&quot;">​</a></h2><p>When Julia is started with multiple threads, it can (and often does) assign more than one thread to the same CPU, even when the requested number of threads is smaller or equal to the total number of CPUs. This is clearly suboptimal.</p><p>The <a href="https://github.com/carstenbauer/ThreadPinning.jl" target="_blank" rel="noreferrer">ThreadPinning.jl</a> package solves this issue. The easiest way to use it by putting <a href="https://carstenbauer.github.io/ThreadPinning.jl/stable/examples/ex_pinning_julia_threads/#pinthreads" target="_blank" rel="noreferrer">the following lines</a> at the top of your Julia script:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPinning</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:cores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Note that this should be changed <a href="/VortexPasta.jl/dev/tips/parallelisation#Pinning-SLURM-threads">when using SLURM</a>.</p><p>One can then check that threads are correctly pinned to separate CPUs using <a href="https://carstenbauer.github.io/ThreadPinning.jl/stable/examples/ex_pinning_julia_threads/#threadinfo_example" target="_blank" rel="noreferrer"><code>threadinfo</code></a>.</p><h2 id="slurm-job" tabindex="-1">Running SLURM jobs <a class="header-anchor" href="#slurm-job" aria-label="Permalink to &quot;Running SLURM jobs {#slurm-job}&quot;">​</a></h2><h3 id="slurm-submitting-jobs" tabindex="-1">Submitting jobs <a class="header-anchor" href="#slurm-submitting-jobs" aria-label="Permalink to &quot;Submitting jobs {#slurm-submitting-jobs}&quot;">​</a></h3><p>Here is a sample SLURM script for running a simulation on which can be submitted using <code>sbatch</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --job-name=&quot;JOB_NAME&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --partition=PARTITION_NAME_ON_CLUSTER</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --time=1:00:00</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --distribution=block:block</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --nodes=1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --ntasks=1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --hint=nomultithread</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --cpus-per-task=32</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --ntasks-per-node=1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --threads-per-core=1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --exclusive</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SBATCH --mem=120G</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; - SLURM_JOB_ID = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_JOB_ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; - SLURM_JOB_NODELIST = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_JOB_NODELIST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; - SLURM_TASKS_PER_NODE = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_TASKS_PER_NODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; - SLURM_CPUS_PER_TASK = </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_CPUS_PER_TASK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">srun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-bind=verbose,cores</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --cpus-per-task=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_CPUS_PER_TASK</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --ntasks-per-node=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_NTASKS_PER_NODE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --threads-per-core=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_THREADS_PER_CORE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  julia</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --heap-size-hint=100G</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --project=.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> script.jl</span></span></code></pre></div><p>Here the number of threads is set via the <code>--cpus-per-task</code> option.</p><p>Some other notes:</p><ul><li><p>the precise <code>SBATCH</code> flags that need to be passed depend on the actual cluster. For example, in some clusters one may also need to pass <code>--constraint</code> and <code>--account</code> flags, while the <code>--partition</code> flag is not necessarily needed.</p></li><li><p>the <code>--exclusive</code> flag is optional; it is recommended if one wants to use a full node (i.e. if the number of requested CPUs corresponds to the total number of CPUs on a node);</p></li><li><p>above, we passed the <code>--heap-size-hint=100G</code> option to the <code>julia</code> command. This may help avoid out of memory errors, by telling Julia&#39;s garbage collector that the total used memory should stay below the specified value. Just to be sure, we also explicitly requested a (slightly larger) amount of memory to SLURM using the <code>--mem</code> option;</p></li><li><p>the <code>--hint=nomultithread</code> option tells SLURM to avoid using hyperthreading, which is generally not good for performance.</p></li></ul><h3 id="Pinning-SLURM-threads" tabindex="-1">Pinning SLURM threads <a class="header-anchor" href="#Pinning-SLURM-threads" aria-label="Permalink to &quot;Pinning SLURM threads {#Pinning-SLURM-threads}&quot;">​</a></h3><p>As mentioned <a href="/VortexPasta.jl/dev/tips/parallelisation#Pinning-threads">above</a>, it is a good idea to pin Julia threads to the CPUs available to the Julia process.</p><p>When using SLURM, one can achieve this by using the <code>:affinitymask</code> criterion in ThreadPinning&#39;s <a href="https://carstenbauer.github.io/ThreadPinning.jl/stable/refs/api_pinning/#ThreadPinning.pinthreads" target="_blank" rel="noreferrer"><code>pinthreads</code></a>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPinning</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:affinitymask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>It can be convenient to have a Julia script which does the Right Thing (TM) depending on whether it runs within a SLURM job or not. To achieve this, one can do:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPinning</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> haskey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SLURM_JOB_ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:affinitymask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:cores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="Using-MKL-FFT-routines" tabindex="-1">Using MKL FFT routines <a class="header-anchor" href="#Using-MKL-FFT-routines" aria-label="Permalink to &quot;Using MKL FFT routines {#Using-MKL-FFT-routines}&quot;">​</a></h2><p>When running on CPUs, the default <a href="/VortexPasta.jl/dev/modules/BiotSavart#VortexPasta.BiotSavart.NonuniformFFTsBackend"><code>NonuniformFFTsBackend</code></a> in VortexPasta.jl computes threaded FFTs using the <a href="https://github.com/JuliaMath/FFTW.jl" target="_blank" rel="noreferrer">FFTW.jl</a> package, which by default wraps the FFTW libraries written in C. However, FFTW.jl has an <a href="https://github.com/JuliaMath/FFTW.jl/issues/236" target="_blank" rel="noreferrer">unresolved issue</a> which can be encountered (somewhat randomly) when computing FFTs using a large number of threads.</p><h3 id="Switching-to-MKL-in-FFTW.jl" tabindex="-1">Switching to MKL in FFTW.jl <a class="header-anchor" href="#Switching-to-MKL-in-FFTW.jl" aria-label="Permalink to &quot;Switching to MKL in FFTW.jl {#Switching-to-MKL-in-FFTW.jl}&quot;">​</a></h3><p>One workaround is to switch to the FFT implementation in Intel&#39;s MKL libraries, which don&#39;t seem to display this issue. The FFTW.jl package makes it easy to <a href="https://github.com/JuliaMath/FFTW.jl?tab=readme-ov-file#mkl" target="_blank" rel="noreferrer">switch</a> to the MKL implementation via their <a href="https://www.intel.com/content/www/us/en/docs/onemkl/developer-reference-fortran/2023-0/fftw3-interface-to-onemkl.html" target="_blank" rel="noreferrer">FFTW interface</a>.</p><p>One simply needs to do:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FFTW</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FFTW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_provider!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mkl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>and restart Julia. This will create (or update) a <code>LocalPreferences.toml</code> file next to the <code>Project.toml</code> file associated to the active Julia project.</p><h3 id="Correctly-using-threads-with-MKL" tabindex="-1">Correctly using threads with MKL <a class="header-anchor" href="#Correctly-using-threads-with-MKL" aria-label="Permalink to &quot;Correctly using threads with MKL {#Correctly-using-threads-with-MKL}&quot;">​</a></h3><p>The above change is not enough if one wants MKL&#39;s FFTs to be efficient when using threads. One also needs to set the following environment variables (for example in a <a href="/VortexPasta.jl/dev/tips/parallelisation#slurm-submitting-jobs">SLURM script</a>):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MKL_NUM_THREADS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SLURM_CPUS_PER_TASK      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># on SLURM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MKL_NUM_THREADS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$NUMBER_OF_JULIA_THREADS  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># in general</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MKL_DYNAMIC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">false</span></span></code></pre></div><p>The <code>MKL_DYNAMIC=false</code> option tells MKL <a href="https://carstenbauer.github.io/ThreadPinning.jl/stable/examples/ex_blas/#Intel-MKL" target="_blank" rel="noreferrer">not to mess around with thread pinning</a>.</p><p>Secondly, one also needs to add:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MKL</span></span></code></pre></div><p>at the start of the Julia script to be run (one may need to <code>]add MKL</code> first). Failing to do this can really degrade performance.</p><p>Note that one can also set the environment variables directly in the Julia script. Including <a href="/VortexPasta.jl/dev/tips/parallelisation#Pinning-SLURM-threads">thread pinning</a>, the beginning of the Julia script could look like:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MKL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPinning</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MKL_NUM_THREADS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># same as number of Julia threads</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MKL_DYNAMIC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> haskey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SLURM_JOB_ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:affinitymask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pinthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:cores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tell threadinfo to give us information about BLAS (and MKL) and optionally about the SLURM set-up.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">threadinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, slurm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> haskey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SLURM_JOB_ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>Note that, with the <code>hints = true</code> option, ThreadPinning will complain about our choice of using <code>MKL_NUM_THREADS = number_of_julia_threads</code>. This warning can be ignored, since FFTs are executed from a single Julia thread and it&#39;s therefore what we want.</p><h2 id="Heterogeneous-clusters" tabindex="-1">Heterogeneous clusters <a class="header-anchor" href="#Heterogeneous-clusters" aria-label="Permalink to &quot;Heterogeneous clusters {#Heterogeneous-clusters}&quot;">​</a></h2><p>It is common to find clusters with heterogeneous CPU architectures. For example, the CPUs used in login and compute nodes are often not the same. This can lead to problems or to suboptimal performance when code is compiled on the login node and executed on a compute node.</p><p>This problem also exists in Julia, as code is &quot;precompiled&quot; when packages are installed or updated by the user (typically in a login node). The <a href="https://juliahpc.github.io/user_gettingstarted/#set_julia_cpu_target_appropriately" target="_blank" rel="noreferrer">solution</a> is to set the <code>JULIA_CPU_TARGET</code> environment variable in the <code>~/.bashrc</code> file (or similar). This could look something like:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JULIA_CPU_TARGET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generic;znver5,clone_all;znver4,clone_all&quot;</span></span></code></pre></div><p>The actual values to put in <code>JULIA_CPU_TARGET</code> (instead of <code>znver4</code> and <code>znver5</code> above) depend on your cluster! To find them, you can run from the login node:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">julia</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Sys.CPU_NAME&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # this gives the architecture of the login node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">srun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [options...] julia -E </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Sys.CPU_NAME&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # this gives the architecture of a compute node (assuming the cluster uses SLURM)</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><div class="edit-link" data-v-4f9813fa><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://https://github.com/jipolanco/VortexPasta.jl/edit/master/docs/src/tips/parallelisation.md" target="_blank" rel="noreferrer" data-v-4f9813fa><!--[--><span class="vpi-square-pen edit-link-icon" data-v-4f9813fa></span> Edit this page<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/VortexPasta.jl/dev/methods/Ewald" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>Ewald summation for Biot–Savart</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/VortexPasta.jl/dev/tips/gpu" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>GPU usage</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://luxdl.github.io/DocumenterVitepress.jl/dev/" target="_blank"><strong>DocumenterVitepress.jl</strong></a><br></p><p class="copyright" data-v-c970a860>© Copyright 2026.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"CfMlqqK_\",\"methods_ewald.md\":\"YrsKfxql\",\"methods_vfm.md\":\"tbh_pHK9\",\"modules_biotsavart.md\":\"DVPZRORg\",\"modules_celllists.md\":\"8QB90NUy\",\"modules_constants.md\":\"-g8oQAVk\",\"modules_diagnostics.md\":\"CGFxNv4m\",\"modules_filamentio.md\":\"BQb0ztWY\",\"modules_filaments.md\":\"auycHzp-\",\"modules_findnearbysegments.md\":\"BL2PsKG8\",\"modules_forcing.md\":\"dZw1-qXh\",\"modules_paddedarrays.md\":\"DW8a-9sm\",\"modules_predefinedcurves.md\":\"fZ87ZXJp\",\"modules_quadratures.md\":\"CVSvDdjq\",\"modules_reconnections.md\":\"DP8V8zod\",\"modules_syntheticfields.md\":\"B-b50Q9H\",\"modules_timestepping.md\":\"B3h1XN81\",\"modules_vectorsofvectors.md\":\"BEziTbMZ\",\"references.md\":\"BYRDbAZU\",\"tips_gpu.md\":\"79M3hjL2\",\"tips_parallelisation.md\":\"D2PX0QPC\",\"tutorials_01-vortex_ring.md\":\"CSBfWSiD\",\"tutorials_02-kelvin_waves.md\":\"BMvTrJBj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VortexPasta\",\"description\":\"Documentation for VortexPasta.jl\",\"base\":\"/VortexPasta.jl/dev/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"logo\":{\"src\":\"/logo.png\",\"width\":24,\"height\":24},\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"VortexPasta.jl\",\"link\":\"/index\"},{\"text\":\"Tutorials\",\"collapsed\":false,\"items\":[{\"text\":\"Vortex ring\",\"link\":\"/tutorials/01-vortex_ring\"},{\"text\":\"Kelvin waves\",\"link\":\"/tutorials/02-kelvin_waves\"}]},{\"text\":\"Explanations\",\"collapsed\":false,\"items\":[{\"text\":\"The vortex filament model\",\"link\":\"/methods/VFM\"},{\"text\":\"Ewald summation for Biot–Savart\",\"link\":\"/methods/Ewald\"}]},{\"text\":\"Tips and tricks\",\"collapsed\":false,\"items\":[{\"text\":\"Parallelisation and clusters\",\"link\":\"/tips/parallelisation\"},{\"text\":\"GPU usage\",\"link\":\"/tips/gpu\"}]},{\"text\":\"Modules\",\"collapsed\":false,\"items\":[{\"text\":\"PaddedArrays\",\"link\":\"/modules/PaddedArrays\"},{\"text\":\"PredefinedCurves\",\"link\":\"/modules/PredefinedCurves\"},{\"text\":\"CellLists\",\"link\":\"/modules/CellLists\"},{\"text\":\"Quadratures\",\"link\":\"/modules/Quadratures\"},{\"text\":\"Filaments\",\"link\":\"/modules/Filaments\"},{\"text\":\"FilamentIO\",\"link\":\"/modules/FilamentIO\"},{\"text\":\"FindNearbySegments\",\"link\":\"/modules/FindNearbySegments\"},{\"text\":\"Constants\",\"link\":\"/modules/Constants\"},{\"text\":\"BiotSavart\",\"link\":\"/modules/BiotSavart\"},{\"text\":\"SyntheticFields\",\"link\":\"/modules/SyntheticFields\"},{\"text\":\"Forcing\",\"link\":\"/modules/Forcing\"},{\"text\":\"VectorsOfVectors\",\"link\":\"/modules/VectorsOfVectors\"},{\"text\":\"Reconnections\",\"link\":\"/modules/Reconnections\"},{\"text\":\"Timestepping\",\"link\":\"/modules/Timestepping\"},{\"text\":\"Diagnostics\",\"link\":\"/modules/Diagnostics\"}]},{\"text\":\"References\",\"link\":\"/references\"},{\"component\":\"VersionPicker\"}],\"sidebar\":[{\"text\":\"VortexPasta.jl\",\"link\":\"/index\"},{\"text\":\"Tutorials\",\"collapsed\":false,\"items\":[{\"text\":\"Vortex ring\",\"link\":\"/tutorials/01-vortex_ring\"},{\"text\":\"Kelvin waves\",\"link\":\"/tutorials/02-kelvin_waves\"}]},{\"text\":\"Explanations\",\"collapsed\":false,\"items\":[{\"text\":\"The vortex filament model\",\"link\":\"/methods/VFM\"},{\"text\":\"Ewald summation for Biot–Savart\",\"link\":\"/methods/Ewald\"}]},{\"text\":\"Tips and tricks\",\"collapsed\":false,\"items\":[{\"text\":\"Parallelisation and clusters\",\"link\":\"/tips/parallelisation\"},{\"text\":\"GPU usage\",\"link\":\"/tips/gpu\"}]},{\"text\":\"Modules\",\"collapsed\":false,\"items\":[{\"text\":\"PaddedArrays\",\"link\":\"/modules/PaddedArrays\"},{\"text\":\"PredefinedCurves\",\"link\":\"/modules/PredefinedCurves\"},{\"text\":\"CellLists\",\"link\":\"/modules/CellLists\"},{\"text\":\"Quadratures\",\"link\":\"/modules/Quadratures\"},{\"text\":\"Filaments\",\"link\":\"/modules/Filaments\"},{\"text\":\"FilamentIO\",\"link\":\"/modules/FilamentIO\"},{\"text\":\"FindNearbySegments\",\"link\":\"/modules/FindNearbySegments\"},{\"text\":\"Constants\",\"link\":\"/modules/Constants\"},{\"text\":\"BiotSavart\",\"link\":\"/modules/BiotSavart\"},{\"text\":\"SyntheticFields\",\"link\":\"/modules/SyntheticFields\"},{\"text\":\"Forcing\",\"link\":\"/modules/Forcing\"},{\"text\":\"VectorsOfVectors\",\"link\":\"/modules/VectorsOfVectors\"},{\"text\":\"Reconnections\",\"link\":\"/modules/Reconnections\"},{\"text\":\"Timestepping\",\"link\":\"/modules/Timestepping\"},{\"text\":\"Diagnostics\",\"link\":\"/modules/Diagnostics\"}]},{\"text\":\"References\",\"link\":\"/references\"}],\"editLink\":{\"pattern\":\"https://https://github.com/jipolanco/VortexPasta.jl/edit/master/docs/src/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/jipolanco/VortexPasta.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://luxdl.github.io/DocumenterVitepress.jl/dev/\\\" target=\\\"_blank\\\"><strong>DocumenterVitepress.jl</strong></a><br>\",\"copyright\":\"© Copyright 2026.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>